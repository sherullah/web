<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/icon/app/144x144.png">
    <meta name="theme-color" content="#ffffff">
    <title>Sherullah Ibadat Adeyat Web</title>
  </head>
  <body>
    <div id="v" >
      <div id="top">
        <div class="overlay top">
          <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <a class="navbar-brand" href="#">Sherullah Ibadat Adeyat</a>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav">
                <li class="nav-item active">
                  <a class="nav-link" href="#" onclick="switchPublication(1)">Bihori <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#" onclick="switchPublication(2)">Daska</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#" onclick="switchPublication(3)">Fajr</a>
                </li>
                <li class="nav-item">
                  <a  href="mailto:sherullahapp@gmail.com" style="font-size: 18px;">Feedback</a>

                </li>
              </ul>
            </div>
          </nav>

          <div class="container">
            <div class="row">
              <div class="col-4">
              </div>
              <div class="col-4">
                <button type="button" id="pageNo" class="btn btn-link" onclick="gotopagePrompt()">Page 1</button>
              </div>
              <div class="col-4">
              </div>
            </div>

          </div>
        </div>
      </div>
      <img id="image"  onclick="toggleToolbars()" style="height: 100%; margin:auto; ">
      <div id="bottom">
        <div class="overlay bottom">
          <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4">
              <div class="dropdown">
                <button id="speed" class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Speed 1.0x
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                  <a class="dropdown-item" onclick="changeSpeed(0.5)" href="#">0.5x</a>
                  <a class="dropdown-item" onclick="changeSpeed(1.0)" href="#">1.0x</a>
                  <a class="dropdown-item" onclick="changeSpeed(1.25)" href="#">1.25x</a>
                  <a class="dropdown-item" onclick="changeSpeed(1.50)" href="#">1.50x</a>
                  <a class="dropdown-item" onclick="changeSpeed(1.75)" href="#">1.75x</a>
                  <a class="dropdown-item" onclick="changeSpeed(2.0)" href="#">2.0x</a>
                </div>
            </div>
            </div>
            <div class="col-md-4"></div>

          </div>

          <div class="row" style="display: flex; align-items: center; margin: 10;">
            <audio id="audio" onloadedmetadata="resetSeekbar()" ontimeupdate="updateSeekbar()"></audio>

            <div id="currentTime" class="col-2">
              00:00
            </div>
            <div class="col-8">
              <input id="seekbar" type="range" name="rng" min="0" step="0.25" value="0" onchange="seek()" style="width: 100%">
            </div>
            <div id="duration" class="col-2">
                00:00
            </div>
          </div>
          <div class="row">
            <div class="col-3">
              <div>
                <button type="button" class="btn btn-secondary action" onclick="minus5secs()">-5 secs</button>
              </div>
            </div>
            <div class="col-3">
              <div>
              <button type="button" class="btn btn-secondary action" onclick="playThisPage()">Play this page</button>
              </div>
            </div>
            <div class="col-3">
              <div>
              <button id="playerState" type="button" class="btn btn-secondary action" onclick="togglePlayback()">Play</button>
              </div>
            </div>
            <div class="col-3">
              <div>

              <button type="button" class="btn btn-secondary action" onclick="add5secs()" >+5 secs</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div style="display: none;"><a href='https://www.counter12.com'><img src='https://www.counter12.com/img-xBx38Y87dcC6c7y1-50.gif' border='0' alt='web counter free'></a><script type='text/javascript' src='https://www.counter12.com/ad.js?id=xBx38Y87dcC6c7y1'></script><br><a href='https://meuip.page/qual-e-o-meu-ip/' target='_blank'></a></div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script>
      var baseImagePath = "./assets",
        baseAudioPath = "./assets",
        audio = document.getElementById("audio"),
        publication = 1,
        imagePageNo = 2,
        audioPageNo = 2,
        playbackRate = 1,
        Constants = {
          1: {
            pages: 118
          },
          2: {
            pages: 5
          },
          3: {
            pages: 20
          }
        };

      initializeApp();

      function play() {
        if(!audio.readyState) {

          audioPageNo = imagePageNo;
          audio.autoplay = true;
          document.getElementById('playerState').innerHTML =  'Playing Page '+ audioPageNo;
        }

        audio.src= baseAudioPath+"/audio/"+publication+"/Page"+zeroFill(audioPageNo, 3)+".mp3"
      }

      function updatePlayerState() {
        if(!audio.paused) {
          document.getElementById('playerState').innerHTML = 'Playing Page '+ audioPageNo;
        } else {
          document.getElementById('playerState').innerHTML = 'Play';
        }
      }

      function switchPublication(newPublication) {
        publication = newPublication;
        imagePageNo = 1;
        audioPageNo = 1;
        initializeApp();
      }

      function togglePlayback() {
        if(!audio.readyState) {
          play();
        }

        if(audio.paused) {
          audio.play();
        } else {
          audio.pause();
        }

        updatePlayerState();
      }

      function changeSpeed(speed) {
        playbackRate = speed;
        setPlaybackRate();
      }

      function gotopagePrompt() {
        let page = prompt('Enter page number');

        if (page==null) {
          return;
        }

        page = parseInt(page);

        if(page > 0 && page <= Constants[publication].pages) {
          gotoPage(page);
        } else {
          alert('Invalid page.');
        }
      }

      function playThisPage() {
        audioPageNo = imagePageNo;
        updatePlayerState();
        play();
      }

      document.getElementById("pageNo").innerHTML = "Page "+ imagePageNo;

    function minus5secs() {
      audio.currentTime = audio.currentTime - 5;
    }

    function add5secs() {
      audio.currentTime = audio.currentTime +5;
    }

    function toggleToolbars() {
      if(document.getElementById("bottom").style.display == 'none'){
        document.getElementById("top").style.display = 'block';
        document.getElementById("bottom").style.display = 'block';

      } else {
        document.getElementById("top").style.display = 'none';
        document.getElementById("bottom").style.display = 'none';
      }
    }

    function slower() {
      playbackRate = playbackRate - 0.5;
      setPlaybackRate();
    }

    function faster() {
      playbackRate = playbackRate + 0.5;
      setPlaybackRate();
   }

   function initializeApp(){
     renderImage();
   }

    function setPlaybackRate() {
      audio.playbackRate = playbackRate;
      document.getElementById("speed").textContent = "Speed "+ playbackRate+"x";
    }

    function zeroFill( number, width )
    {
      width -= number.toString().length;
      if ( width > 0 )
      {
        return new Array( width + (/\./.test( number ) ? 2 : 1) ).join( '0' ) + number;
      }
      return number + ""; // always return a string
    }

document.onkeydown = checkKey;

function checkKey(e) {
    e = e || window.event;

    if (e.keyCode == '38') {
        // up arrow
    }
    else if (e.keyCode == '40') {
        // down arrow
    }
    else if (e.keyCode == '37') {
       // right arrow
       next();

    } else if (e.keyCode == '39') {
       // right arrow
       previous();
    }

}


    setPlaybackRate();

    function previous() {
      if(imagePageNo<=1) return;

      imagePageNo = imagePageNo -1;
      renderImage();
    }


    function gotoPage(page) {
      if(page<=1) return;
      if(page>Constants[publication].pages) return;

      imagePageNo = page;
      renderImage();
    }

    function renderImage(){
      document.getElementById('pageNo').innerHTML="Page "+ imagePageNo;

      document.getElementById('image').src=baseImagePath + "/pages/"+publication+"/"+imagePageNo+".jpg";
    }

    function next() {
      if(imagePageNo > Constants[publication].pages) {
        return;
      }

      imagePageNo = imagePageNo +1;
      renderImage();
    }


var dur= document.getElementById('dur')
function mDur(){
  dur.max= audio.duration
}
function mPlay(){dur.value=audio.currentTime}
function mSet(){audio.currentTime=dur.value}

    function resetSeekbar(){
      document.getElementById('seekbar').max = audio.duration;

    }
    function updateSeekbar(){
      document.getElementById('currentTime').innerHTML = zeroFill(parseInt(audio.currentTime/60), 2) +":"+ zeroFill(parseInt(audio.currentTime%60), 2);
      document.getElementById('duration').innerHTML = zeroFill(parseInt(audio.duration/60), 2) +":"+ zeroFill(parseInt(audio.duration%60), 2);
      document.getElementById('seekbar').value= audio.currentTime;
    }
    function seek(){
      audio.currentTime = document.getElementById('seekbar').value;
    }

    audio.onended = function() {
      next();
      audioPageNo = imagePageNo;
      play();
    };
    document.addEventListener('touchstart', handleTouchStart, false);
document.addEventListener('touchmove', handleTouchMove, false);

var xDown = null;
var yDown = null;

function getTouches(evt) {
  return evt.touches ||             // browser API
         evt.originalEvent.touches; // jQuery
}

function handleTouchStart(evt) {
    const firstTouch = getTouches(evt)[0];
    xDown = firstTouch.clientX;
    yDown = firstTouch.clientY;
};

function handleTouchMove(evt) {
    if ( ! xDown || ! yDown ) {
        return;
    }

    var xUp = evt.touches[0].clientX;
    var yUp = evt.touches[0].clientY;

    var xDiff = xDown - xUp;
    var yDiff = yDown - yUp;

    if ( Math.abs( xDiff ) > Math.abs( yDiff ) ) {/*most significant*/
        if ( xDiff > 0 ) {
            /* left swipe */
            previous();
        } else {
            /* right swipe */
            next();
        }
    } else {
        if ( yDiff > 0 ) {
            /* up swipe */
        } else {
            /* down swipe */
        }
    }
    /* reset values */
    xDown = null;
    yDown = null;
};
var onlongtouch;
var timer;
var touchduration = 500; //length of time we want the user to touch before we do something

function touchstart() {
    timer = setTimeout(onlongtouch, touchduration);
}

function  touchend() {

    //stops short touches from firing the event
    if (timer)
        clearTimeout(timer); // clearTimeout, not cleartimeout..
}

onlongtouch = function() {
  playThisPage();
 };

if ('serviceWorker' in navigator) {
    console.log("Will the service worker register?");
    navigator.serviceWorker.register('service-worker.js')
      .then(function(reg){
        console.log("Yes, it did.");
     }).catch(function(err) {
        console.log("No it didn't. This happened:", err)
    });
  }
    </script>
    <style>
  .overlay {
  color: #FFF;
  text-align: center;
  font-size: 20px;
  background-color: #343A40;
  width: 100%;
  padding: 10px 0;
  z-index: 2147483647;
}

.top {
  position: fixed;
}

.bottom {
  position: fixed;
  bottom:0%;
}


.control {
  padding: 5;
  height: 4em;
}

.action {
  height: 4em;
  width: 6em;
}

#v {
  z-index: 1;
  text-align: center
}
    </style>
  </body>
</html>
